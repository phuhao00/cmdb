# CMDB 权限管理和审批系统使用指南

## 系统概述

本CMDB系统现已集成完整的用户认证、权限管理和资产操作审批功能。

## 用户角色和权限

### 角色类型

1. **管理员 (Admin)**
   - 拥有所有权限
   - 可以创建和管理用户
   - 可以审批所有工作流
   - 可以进行所有资产操作

2. **经理 (Manager)**
   - 可以审批工作流
   - 可以进行资产的增删改查
   - 可以查看所有报告
   - 不能管理用户

3. **操作员 (Operator)**
   - 可以创建和修改资产（需要审批）
   - 可以查看工作流状态
   - 可以查看报告
   - 不能删除资产或审批

4. **查看者 (Viewer)**
   - 只能查看资产、工作流和报告
   - 不能进行任何修改操作

## 登录系统

### 默认管理员账户
- **用户名**: admin
- **密码**: admin123
- **角色**: 管理员

### 登录流程
1. 访问系统首页会自动跳转到登录页面
2. 输入用户名和密码
3. 登录成功后根据用户权限显示相应的功能模块

## 审批工作流

### 需要审批的操作

1. **资产创建**: 操作员和经理创建资产时需要管理员或经理审批
2. **资产修改**: 重要信息修改需要审批
3. **资产删除**: 所有删除操作都需要审批

### 审批流程

1. **提交申请**: 用户执行操作时自动创建工作流
2. **等待审批**: 工作流状态为"待审批"
3. **审批决定**: 具有审批权限的用户可以批准或拒绝
4. **执行结果**: 批准后自动执行相应操作

### 审批操作

1. 进入"工作流"页面
2. 查看"待审批"列表
3. 点击具体工作流查看详情
4. 选择"批准"或"拒绝"并填写备注

## 权限控制

### 前端权限控制
- 导航菜单根据用户权限动态显示
- 操作按钮根据权限启用/禁用
- 页面内容根据权限过滤

### 后端权限控制
- API接口级别的权限验证
- 中间件自动检查用户权限
- 操作日志记录

## 用户管理（仅管理员）

### 创建用户
1. 登录管理员账户
2. 点击用户头像 → 用户管理
3. 填写用户信息和角色
4. 提交创建

### 管理用户
- 查看用户列表
- 修改用户状态（激活/禁用）
- 重置用户密码

## 系统启动

### 后端启动
```bash
cd backend
go mod tidy
go run main.go
```

### 前端启动
```bash
cd frontend-react
npm install
npm start
```

### MongoDB启动
确保MongoDB运行在 `mongodb://localhost:27017`

## API接口

### 认证接口
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `GET /api/auth/me` - 获取当前用户信息

### 资产接口（需要权限）
- `GET /api/assets` - 查看资产列表
- `POST /api/assets` - 创建资产（需要审批）
- `PUT /api/assets/:id` - 修改资产（需要审批）
- `DELETE /api/assets/:id` - 删除资产（需要审批）

### 工作流接口
- `GET /api/workflows` - 查看工作流
- `GET /api/workflows/pending` - 查看待审批工作流
- `POST /api/workflows/:id/approve` - 审批工作流
- `POST /api/workflows/:id/reject` - 拒绝工作流

## 注意事项

1. **首次登录**: 使用默认管理员账户登录后，建议立即修改密码
2. **权限测试**: 创建不同角色的测试用户来验证权限功能
3. **审批流程**: 所有重要操作都需要审批，确保系统安全
4. **会话管理**: 会话24小时后自动过期，需要重新登录

## 故障排除

### 登录失败
- 检查用户名和密码是否正确
- 确认用户状态是否为"激活"
- 检查后端服务是否正常运行

### 权限错误
- 确认用户角色和权限配置
- 检查API接口的权限中间件
- 查看浏览器控制台的错误信息

### 审批问题
- 确认审批者具有相应权限
- 检查工作流状态是否正确
- 验证后端工作流服务是否正常

## 系统安全

1. **密码安全**: 使用bcrypt加密存储
2. **会话管理**: JWT token和服务器端会话双重验证
3. **权限验证**: 前后端双重权限检查
4. **操作日志**: 记录所有重要操作和审批决定
5. **API保护**: 所有敏感接口都需要认证和授权

通过以上配置，您的CMDB系统现在具备了完整的权限管理和审批功能！ 